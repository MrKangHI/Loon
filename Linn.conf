# ---------------------------------------
# Looné…ç½® by Tartarus ddgksf2013
# ä¿®æ”¹ç‰ˆæœ¬ by MrKangHI
# Loonå®˜æ–¹æ–‡æ¡£ï¼šhttps://nsloon.app/docs/intro
# Loonæ•™ç¨‹é“¾æŽ¥ï¼šhttps://coffee-elderberry-22b.notion.site/Loon-71747252d5054551a8cd10924064899c
# Loonç¬¬ä¸‰æ–¹çŸ¥è¯†åº“ï¼šhttps://t.me/ibilibili/581
# Loonè§„åˆ™GitHubï¼šhttps://github.com/blackmatrix7/ios_rule_script/tree/master/rule/Loon

# ---------------------------------------
# å¯¼å…¥é…ç½®ã€‚
# å¯¼å…¥å®ŒæˆåŽç‚¹ https://www.nsloon.com/openloon/flowmodel=filter åˆ‡æ¢è‡³è‡ªåŠ¨åˆ†æµæ¨¡å¼ã€‚
# å†ç‚¹ https://www.nsloon.com/openloon/proxymode=tun åˆ‡æ¢ä»£ç†æ¨¡å¼è‡³ TUN Only æ¨¡å¼ [æ­¤æ“ä½œç‚¹å‡»è·³è½¬è‡³LoonåŽå³ä¸ºåˆ‡æ¢æˆåŠŸ]ã€‚
# æ‰“å¼€ï¼»MitMï¼½ï¼»è„šæœ¬ï¼½ï¼»å¤å†™ï¼½ä¸‰ä¸ªåŠŸèƒ½çš„å¼€å…³ã€‚
# æ‰“å¼€ï¼»MitMï¼½é‡Œçš„ï¼»MitM over HTTP/2ï¼½å’Œï¼»QUICå›žé€€ä¿æŠ¤ï¼½å¼€å…³ã€‚
# ä¿è¯Safariæ˜¯é»˜è®¤æµè§ˆå™¨çš„æƒ…å†µä¸‹ï¼Œå®‰è£…å¹¶ä¿¡ä»»è¯ä¹¦ã€‚
# ç‚¹å‡»Loonåº•éƒ¨å¯¼èˆªæ çš„ï¼»é…ç½®ï¼½â†’ å³ä¸Šè§’çš„ï¼»â‹¯ï¼½ï¼Œæ‰“å¼€ï¼»å§‹ç»ˆå¼€å¯ï¼½çš„å¼€å…³ã€‚
# æ·»åŠ ä½ çš„æœºåœºè®¢é˜…ã€‚
# æ‰“å¼€Loonçš„å¼€å…³åŽå¹¶ç‚¹å‡» https://www.nsloon.com/openloon/update?sub=all ä¸€é”®æ›´æ–°æ‰€æœ‰å¤–éƒ¨èµ„æºã€‚

# ---------------------------------------
æ’ä»¶åº“ï¼š
https://loon-plugin.vercel.app/
https://whatshub.top/loon/

# ---------------------------------------
[General]
# IPv6 æ”¯æŒ
ip-mode = dual
ipv6-vif = auto
# UDPç›¸å…³
disable-stun = true
udp-fallback-mode = REJECT
# SNIè¾…åŠ©è§„åˆ™åŒ¹é…
sni-sniffing = true
# ç­–ç•¥ç»„åˆ‡æ¢æ—¶å…³é—­è¿žæŽ¥
disconnect-on-policy-change = true
# åŸŸåæ‹¦æˆªè¡Œä¸º
domain-reject-mode = DNS
# > è·³è¿‡ä»£ç†
# è·³è¿‡æŸä¸ªåŸŸåæˆ–è€… IP æ®µï¼Œè¿™äº›ç›®æ ‡ä¸»æœºå°†ä¸ä¼šç”± Loon Proxy å¤„ç†ã€‚
skip-proxy = localhost,*.local,captive.apple.com,e.crashlytics.com,www.baidu.com,passenger.t3go.cn,yunbusiness.ccb.com,wxh.wo.cn,gate.lagou.com,www.abchina.com.cn,login-service.mobile-bank.psbc.com,mobile-bank.psbc.com,10.0.0.0/8,127.0.0.1/32,172.16.0.0/12,192.168.0.0/16,192.168.122.1/32,193.168.0.1/32,::1/128,fe80::/10
# > Always Real IP Hosts
# DNS æ•°æ®åŒ…å°†è¢«è½¬å‘åˆ°ä¸Šæ¸¸ DNS æœåŠ¡å™¨ã€‚
real-ip = *.10099.com.cn,*.cmpassport.com,*.jegotrip.com.cn,*.icitymobile.mobi,id6.me,*.pingan.com.cn
# ç»•è¿‡è·¯ç”±
bypass-tun = 10.0.0.0/8,100.64.0.0/10,127.0.0.0/8,169.254.0.0/16,172.16.0.0/12,192.0.0.0/24,192.0.2.0/24,192.88.99.0/24,192.168.0.0/16,198.18.0.0/15,198.51.100.0/24,203.0.113.0/24,224.0.0.0/4,255.255.255.255/32
# DNS æœåŠ¡å™¨
dns-server = 119.29.29.29,8.8.8.8
doh-server = https://dns.google/dns-query,https://dns.cloudflare.com/dns-query,https://101.101.101.101/dns-query
doh3-server = https://dns.google/dns-query,https://dns.cloudflare.com/dns-query,https://101.101.101.101/dns-query
# Hijack DNS
# é»˜è®¤æƒ…å†µä¸‹ï¼ŒLoon åªè¿”å›žå‘é€åˆ° Loon DNS åœ°å€çš„ DNS æŸ¥è¯¢çš„å‡ IP åœ°å€(198.18.0.2)ã€‚
# æœ‰äº›è®¾å¤‡æˆ–è½¯ä»¶æ€»æ˜¯ä½¿ç”¨ç¡¬ç¼–ç çš„ DNS æœåŠ¡å™¨ã€‚ (ä¾‹å¦‚ Google Speakers æ€»æ˜¯ä½¿ç”¨ 8.8.8.8)ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹åŠ«æŒæŸ¥è¯¢ï¼Œä»¥èŽ·å¾—ä¸€ä¸ªå‡åœ°å€ã€‚
hijack-dns = 8.8.8.8:53,8.8.4.4:53
# Wi-Fi è®¿é—®
allow-wifi-access = false
wifi-access-http-port = 1234
wifi-access-socks5-port = 1235
mitm-on-wifi-access = false
# ä»£ç†æµ‹é€Ÿ URL
internet-test-url = http://www.gstatic.com/generate_204
proxy-test-url = http://www.gstatic.com/generate_204
# æµ‹é€Ÿè¶…æ—¶ (s)
test-timeout = 5
# ç½‘ç»œæŽ¥å£
interface-mode = auto
# å½“èŠ‚ç‚¹è¿žç»­å¤±è´¥å¤šå°‘æ¬¡åŽå¼€å§‹åˆ‡æ¢èŠ‚ç‚¹
switch-node-after-failure-times = 3
# ssid-triggerå‚æ•°ï¼Œç”¨äºŽæŒ‡å®šSSIDä¸‹æµé‡æ¨¡å¼åˆ‡æ¢ï¼Œï¼ˆdefaultè¡¨ç¤ºé»˜è®¤ï¼Œcellularè¡¨ç¤ºèœ‚çªï¼Œç›®å‰æ”¯æŒä¸‰ç§å€¼ï¼šruleï¼Œdirectï¼Œproxyï¼‰ 
# ssid-trigger = "default":rule, "cellular":rule,"ASUS_5G":direct
# geoipå’Œasn
geoip-url = https://cdn.jsdelivr.net/gh/Loyalsoldier/geoip@release/Country.mmdb
ipasn-url = https://cdn.jsdelivr.net/gh/P3TERX/GeoLite.mmdb@download/GeoLite2-ASN.mmdb
# è§£æžå™¨
resource-parser = https://cdn.jsdelivr.net/gh/sub-store-org/Sub-Store@release/sub-store-parser.loon.min.js

# ---------------------------------------
[Host]

# ---------------------------------------
[Proxy]

# ---------------------------------------
[Remote Proxy]

# ---------------------------------------
[Proxy Group]
FINAL = select,DIRECT,èŠ‚ç‚¹é€‰æ‹©,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png
å…¨çƒåŠ é€Ÿ = select,DIRECT,èŠ‚ç‚¹é€‰æ‹©,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Global.png
èŠ‚ç‚¹é€‰æ‹© = url-test,é¦™æ¸¯èŠ‚ç‚¹,å°æ¹¾èŠ‚ç‚¹,ç‹®åŸŽèŠ‚ç‚¹,æ—¥æœ¬èŠ‚ç‚¹,é˜¿ç¾Žåˆ©å¡,åŠ æ‹¿å¤§é¹…,æ¬§ç›Ÿå§”å‘˜ä¼š,æ—¥ä¸è½å¸å›½,interval = 600,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Proxy.png
è‹¹æžœæœåŠ¡ = select,DIRECT,èŠ‚ç‚¹é€‰æ‹©,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Apple.png
å›½é™…åª’ä½“ = select,DIRECT,èŠ‚ç‚¹é€‰æ‹©,é¦™æ¸¯èŠ‚ç‚¹,å°æ¹¾èŠ‚ç‚¹,é˜¿ç¾Žåˆ©å¡,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Streaming.png
Spotify = select,DIRECT,èŠ‚ç‚¹é€‰æ‹©,é¦™æ¸¯èŠ‚ç‚¹,å°æ¹¾èŠ‚ç‚¹,é˜¿ç¾Žåˆ©å¡,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Spotify.png
# å“”å“©å“”å“© = select,DIRECT,èŠ‚ç‚¹é€‰æ‹©,é¦™æ¸¯èŠ‚ç‚¹,å°æ¹¾èŠ‚ç‚¹,é˜¿ç¾Žåˆ©å¡,img-url = https://raw.githubusercontent.com/lige47/QuanX-icon-rule/main/icon/bilibili.png
æ—¥ä¸è½å¸å›½ = url-test,è‹±å›½,interval = 600,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_Kingdom.png
é˜¿ç¾Žåˆ©å¡ = url-test,ç¾Žå›½,url = http://www.qualcomm.cn/generate_204,interval = 600,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png
é¦™æ¸¯èŠ‚ç‚¹ = url-test,é¦™æ¸¯,url = http://www.qualcomm.cn/generate_204,interval = 600,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png
å°æ¹¾èŠ‚ç‚¹ = url-test,å°æ¹¾,url = http://www.qualcomm.cn/generate_204,interval = 600,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png
ç‹®åŸŽèŠ‚ç‚¹ = url-test,æ–°åŠ å¡,url = http://www.qualcomm.cn/generate_204,interval = 600,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png
# éŸ©å›½èŠ‚ç‚¹ = url-test,éŸ©å›½,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Korea.png
æ—¥æœ¬èŠ‚ç‚¹ = url-test,æ—¥æœ¬,url = http://www.qualcomm.cn/generate_204,interval = 600,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png
åŠ æ‹¿å¤§é¹… = url-test,åŠ æ‹¿å¤§,interval = 600,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Canada.png
æ¬§ç›Ÿå§”å‘˜ä¼š = url-test,æ¬§ç›Ÿ,interval = 600,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/European_Union.png
# è§£é”èŠ‚ç‚¹ = select,ç½‘æ˜“è§£é”,img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Netease_Music_Unlock.png

# ---------------------------------------
[Remote Filter]
åŠ æ‹¿å¤§ = NameRegex, FilterKey = "CA"
é¦™æ¸¯ = NameRegex, FilterKey = "(?i)(æ¸¯|HK|Hong)"
å°æ¹¾ = NameRegex, FilterKey = "(?i)(å°|TW|Tai)"
æ—¥æœ¬ = NameRegex, FilterKey = "(?i)(æ—¥æœ¬|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼çŽ‰|æ²ªæ—¥|æ·±æ—¥|JP|Japan)"
éŸ©å›½ = NameRegex, FilterKey = "(?i)(KR|Korea|KOR|é¦–å°”|éŸ©|éŸ“)"
ç¾Žå›½ = NameRegex, FilterKey = "(?i)(ç¾Ž|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸŽ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡ž|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|US|United States)"
æ–°åŠ å¡ = NameRegex, FilterKey = "(?i)(æ–°åŠ å¡|å¡|ç‹®åŸŽ|SG|Singapore)"
è‹±å›½ = NameRegex, FilterKey = "ðŸ‡¬ðŸ‡§|è‹±å›½|UK|ä¼¦æ•¦|è‹±æ ¼å…°|ä¼¯æ˜Žç¿°|æ³°æ©æ²³ç•”çº½å¡æ–¯å°”|åˆ©å…¹|çˆ±ä¸å ¡|æ ¼æ‹‰æ–¯å“¥|è‹æ ¼å…°"
æ¬§ç›Ÿ = NameRegex, FilterKey = "(?=.*(?i)(å¾·å›½|Germany|æ³•å›½|France|æ„å¤§åˆ©|Italy|è¥¿ç­ç‰™|Spain|å¥¥åœ°åˆ©|Austria|æ¯”åˆ©æ—¶|Belgium|ä¿åŠ åˆ©äºš|Bulgaria|å…‹ç½—åœ°äºš|Croatia|å¡žæµ¦è·¯æ–¯|Cyprus|æ·å…‹|Czechia|æ·å…‹å…±å’Œå›½|Czech Republic|ä¸¹éº¦|Denmark|çˆ±æ²™å°¼äºš|Estonia|èŠ¬å…°|Finland|å¸Œè…Š|Greece|åŒˆç‰™åˆ©|Hungary|çˆ±å°”å…°|Ireland|æ‹‰è„±ç»´äºš|Latvia|ç«‹é™¶å®›|Lithuania|å¢æ£®å ¡|Luxembourg|é©¬è€³ä»–|Malta|è·å…°|Netherlands|æ³¢å…°|Poland|è‘¡è„ç‰™|Portugal|ç½—é©¬å°¼äºš|Romania|æ–¯æ´›ä¼å…‹|Slovakia|æ–¯æ´›æ–‡å°¼äºš|Slovenia|ç‘žå…¸|Sweden))"

# ---------------------------------------
[Remote Rule]
https://raw.githubusercontent.com/ddgksf2013/Filter/master/Unbreak.list, policy=DIRECT, tag=è§„åˆ™ä¿®æ­£, enabled=true
https://raw.githubusercontent.com/Cats-Team/AdRules/main/qx.conf, policy=REJECT, tag=å¹¿å‘Šç»ˆç»“è€…, enabled=true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/QuantumultX/WeChat/WeChat.list, policy=DIRECT, tag=å¾®ä¿¡ç›´è¿ž, enabled=false
https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Loon/Tencent/Tencent.list, policy=DIRECT, tag=Tencent, enabled=false
https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Loon/DouYin/DouYin.list, policy=DIRECT, tag=æŠ–éŸ³, enabled=false
https://raw.githubusercontent.com/ddgksf2013/Filter/master/GoogleVoice.list, policy=é˜¿ç¾Žåˆ©å¡, tag=Google Voice, enabled=true
https://gist.githubusercontent.com/ddgksf2013/cb4121e8b5c5d865cc949cb8120320c4/raw/Ai.yaml, policy=é˜¿ç¾Žåˆ©å¡, tag=Ai-All-In-One, enabled=true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/QuantumultX/Spotify/Spotify.list, policy=Spotify, tag=SpotifyéŸ³ä¹, enabled=true
https://raw.githubusercontent.com/ddgksf2013/Filter/master/Streaming.list, policy=å›½é™…åª’ä½“, tag=å›½é™…åª’ä½“, enabled=true
https://raw.githubusercontent.com/ddgksf2013/Filter/master/StreamingSE.list, policy=å“”å“©å“”å“©, tag=å“”å“©å“”å“©, enabled=false
https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Loon/Apple/Apple.list, policy=è‹¹æžœæœåŠ¡, tag=è‹¹æžœæœåŠ¡, enabled=true
https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Loon/Apple/Apple_Domain.list, policy=è‹¹æžœæœåŠ¡, tag=è‹¹æžœæœåŠ¡_åŸŸå, enabled=true
https://raw.githubusercontent.com/ConnersHua/RuleGo/master/Surge/Ruleset/Proxy.list, policy=å…¨çƒåŠ é€Ÿ, tag=å…¨çƒåŠ é€Ÿ, enabled=true
https://raw.githubusercontent.com/VirgilClyne/GetSomeFries/main/ruleset/ASN.China.list, policy=DIRECT, tag=å›½å†…ç½‘ç«™, enabled=false
https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Loon/ChinaMax/ChinaMax.list, policy=DIRECT, tag=å›½å†…ç½‘ç«™/IPåˆé›†, enabled=true
https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Loon/ChinaMax/ChinaMax_Domain.list, policy=DIRECT, tag=å›½å†…ç½‘ç«™/IPåˆé›†-Domain, enabled=true

# ---------------------------------------
[Rule]
# > ä¸€äº›æ¯”è¾ƒå®¹æ˜“å¿½è§†çš„åˆ†æµ
# DOMAIN, ad.12306.cn, DIRECT
# DOMAIN, sdkapp.uve.weibo.com, DIRECT
# DOMAIN-KEYWORD, github, FINAL

# > local
IP-CIDR, 10.0.0.0/8, DIRECT
IP-CIDR, 127.0.0.0/8, DIRECT
IP-CIDR, 172.16.0.0/12, DIRECT
IP-CIDR, 192.168.0.0/16, DIRECT
IP-CIDR, 224.0.0.0/24, DIRECT
IP-CIDR, 182.254.116.0/24, DIRECT

# > geoip
GEOIP, CN, DIRECT
FINAL, FINAL

# ---------------------------------------
[Rewrite]

# ---------------------------------------
[Remote Rewrite]

# ---------------------------------------
[Script]

# ---------------------------------------
[Remote Script]

# ---------------------------------------
[Plugin]
https://kelee.one/Tool/Loon/Lpx/Block_HTTPDNS.lpx, enabled=true
https://kelee.one/Tool/Loon/Lpx/BlockAdvertisers.lpx, enabled=true
https://kelee.one/Tool/Loon/Lpx/Remove_ads_by_keli.lpx, enabled=true
https://kelee.one/Tool/Loon/Lpx/Script-Hub.lpx, enabled=true
https://kelee.one/Tool/Loon/Lpx/Sub-Store.lpx, policy=FINAL, enabled=true
https://kelee.one/Tool/Loon/Lpx/Node_detection_tool.lpx, enabled=true
https://kelee.one/Tool/Loon/Lpx/QuickSearch.lpx, enabled=true

# ---------------------------------------
[Mitm]
ca-p12 = 
ca-passphrase = 
hostname = 
skip-server-cert-verify = false

# ---------------------------------------
